{% extends "contests/includes/base.html" %} {% block title %} Create a Contest {% endblock title %} q {% block content %}
{% load bootstrap4 %}


<div class="row">
    
    <div class=" card col-md-7 container shadow">
        <br>
        <h1>Create a Contest</h1>
        <hr>
        <form method="POST" enctype="multipart/form-data">
            <br> {% csrf_token %} 
            {% bootstrap_field form.title %} 
            {% bootstrap_field form.end_date %} 
            {% bootstrap_field form.prize %} 
            {% bootstrap_field form.category %} 
            {% bootstrap_field form.preferred_style %} 
            {% bootstrap_field form.preferred_colors %} 
            {% bootstrap_field form.target_audience %} 
            {% bootstrap_field form.design_details %}
            {% bootstrap_field form.would_like_to_print %} 
            {% bootstrap_field form.logo %} 
            {% bootstrap_field form.sketch %}

            <br><br><br>
    </div>
    <div class="col-md-1"></div>
    <div class="col-md-4 ml-auto card container " style="height:45rem;">
        <br>
        <h4>Get the most from your contest!</h4>
        <hr><br>
        <div class="row">
            <div class="col-3">
                <center>{% bootstrap_field form.is_top %} </center>
                <h4>GHS30</h4><br>
                <center>{% bootstrap_field form.is_hidden %}</center>
                <h4>GHS25</h4><br>
                <center>{% bootstrap_field form.is_nda %}</center>
                <h4>GHS15</h4><br>
                <center>{% bootstrap_field form.is_sealed %}</center>
                <h4>GHS20</h4><br>
            </div>
            <div class="col-9">
                <button type="button" class="btn btn-danger btn-block" onclick="triggerCheckbox('#id_is_top')">TOP</button>
                <center>
                    <div class="help-block">Make top contest (Get top brandlancers to participate)</div>
                </center><br>
                <button type="button" class="btn  btn-block" onclick="triggerCheckbox('#id_is_hidden')">HIDDEN</button>
                <center>
                    <div class="help-block">Hide all entries (this would ensure designers submit more original works)</div>
                </center><br>
                <button type="button" class="btn btn-primary btn-block" onclick="triggerCheckbox('#id_is_nda')">NDA</button>
                <center>
                    <div class="help-block">Add a Non-Disclosure Agreement</div>
                </center><br>
                <button type="button" class="btn btn-dark btn-block" onclick="triggerCheckbox('#id_is_sealed')">PRIVATE</button>
                <center>
                    <div class="help-block">Make contest private. Only brandlancers can view.</div>
                </center><br>


            </div>
        </div>
        {% buttons %}
        <center>
            <h4>Total: GHS<span id="totalCost">0</span>.00</h4>
        </center>
        <hr>
        <center>By clicking 'Post Contest' button you accept our <strong>Terms of Use</strong> and <strong>Privacy Policy</strong></center>
        <br>
        <button type='submit' class="btn btn-success btn-block ">Post Contest</button> {% endbuttons %}
    </div>
    </form>
</div>

<style>
    .help-block {
        color: #868e96
    }
</style>

<script>
    var category_price = 0;
    var top_price = 0;
    var hidden_price = 0;
    var sealed_price = 0;
    var nda_price = 0;

    var category_costs = "{{ category_prices }}";
    category_costs = JSON.parse(category_costs.replace(/&quot;/g,'"'));

    function updateCost(){
        totalCost = category_price + top_price + hidden_price + nda_price + sealed_price;
        $("#totalCost").text(totalCost);
    }

    function findCategoryPrice(category_id){
        var price = 0;
        $.each(category_costs, function(){
            if(this.id==category_id){
                price = this.prize_lower_limit;
            }
        });
        return price;
    }

    $("#id_category").change(
        function(){
            newCategory = $("select option:selected").val();
            newCategoryPrize = findCategoryPrice(newCategory);
            console.log('new category prize is '+newCategoryPrize);
            category_price = newCategoryPrize;
            updateCost();
        }
    );

    

    function triggerCheckbox(checkbox) {
        var button = $(checkbox);
        if (button.prop("checked") == true) {
            button.prop("checked", false);
            if(checkbox=="#id_is_nda"){
                console.log("nda");
            }else if(checkbox=="#id_is_top"){
                console.log("top");
            }else if(checkbox=="#id_is_sealed"){
                console.log("sealed");
            }else if(checkbox=="#id_is_hidden"){
                console.log("hidden");
            }

        } else {
            button.prop("checked", true);
            if(checkbox=="#id_is_nda"){
                console.log("nda");
            }else if(checkbox=="#id_is_top"){
                console.log("top");
            }else if(checkbox=="#id_is_sealed"){
                console.log("sealed");
            }else if(checkbox=="#id_is_hidden"){
                console.log("hidden");
            }
        }
    }

    $('input:checkbox').change(
        function () {
            if ($(this).is(':checked')) {
                var newTotal = parseInt($('#totalCost').val());
                newTotal = newTotal + parseInt('30');
                $("#totalCost").text(newTotal);
            }
        });


    $(document).ready(function () {
        var now = new Date();
        var numberOfDaysToAdd = 3;
        newDate = now.setDate(now.getDate() + numberOfDaysToAdd);
        var day = ("0" + now.getDate()).slice(-2);
        var month = ("0" + (now.getMonth() + 1)).slice(-2);
        var today = now.getFullYear() + "-" + (month) + "-" + (day);
        $("#id_end_date").val(today);

        //$("#id_prize").val(500)
    });

</script>

{% endblock content %}